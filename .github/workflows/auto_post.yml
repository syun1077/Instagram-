name: Instagram Auto Post

on:
  schedule:
    # 毎日22:00(日本時間)に実行 = UTC 13:00
    - cron: '0 13 * * *'
  workflow_dispatch:  # 手動実行も可能

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Create .env file
        run: |
          echo "INSTAGRAM_ACCESS_TOKEN=${{ secrets.INSTAGRAM_ACCESS_TOKEN }}" > .env
          echo "INSTAGRAM_ACCOUNT_ID=${{ secrets.INSTAGRAM_ACCOUNT_ID }}" >> .env

      - name: Create token_info.json
        run: |
          echo '{
            "user_token": "${{ secrets.USER_TOKEN }}",
            "page_token": "${{ secrets.INSTAGRAM_ACCESS_TOKEN }}",
            "account_id": "${{ secrets.INSTAGRAM_ACCOUNT_ID }}",
            "last_updated": "2025-01-01T00:00:00"
          }' > token_info.json

      - name: Run auto post
        run: python auto_post.py

      - name: Show log
        if: always()
        run: cat auto_post.log || echo "No log file"
